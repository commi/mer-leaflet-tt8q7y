<div class="card flex-grow-1">
  <form class="card-body" id="form_settings">
    <div class="row align-items-stretch">
      <!-- Karte -->
      <div class="col-12">
        <h4 class="h5">Fahrten pro Antriebsart pro Autobahnabschnitt</h4>

        <div class="position-relative">
          <div #mapContainer id="map"></div>
          <h2 id="label_year" class="position-absolute top-0 end-0 p-2">{{ scenarioState.year$ | async }}</h2>
        </div>
      </div>

      <!-- controls for year -->
      <div class="col-12">
        <div class="row g-3 pt-2">
          <div class="col-auto">
            <label class="form-label" for="input_year">Jahr</label>
          </div>
          <div class="col-auto">
            <label class="form-label" for="input_year">2025</label>
          </div>
          <div class="col">
            <input class="form-range" type="range" min="2025" max="2045" [value]="scenarioState.year$ | async"
                   id="input_year" (input)="onYearChange($event)">
          </div>
          <div class="col-auto">
            <label class="form-label" for="input_year">2045</label>
          </div>
        </div>
      </div>

      <!-- controls for map layer visibility -->
      <div class="col-12 mb-3 col-md-6 mb-md-0 d-flex align-items-stretch">
        <div class="card flex-fill">
          <div class="card-body">
            <h4 class="h5">Anzuzeigende Größe</h4>

            <div class="form-check">
              <input class="form-check-input" type="radio" name="visible_layer"
                     id="visible_layer_oberleitungsausbau" value="Oberleitungsausbau"
                     [ngModel]="scenarioState.visibleLayer$ | async"
                     (ngModelChange)="scenarioState.visibleLayer$.next($event)">
              <label class="form-check-label" for="visible_layer_oberleitungsausbau">
                Oberleitungsausbau
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="visible_layer"
                     id="visible_layer_diesel" value="Diesel"
                     [ngModel]="scenarioState.visibleLayer$ | async"
                     (ngModelChange)="scenarioState.visibleLayer$.next($event)">
              <label class="form-check-label" for="visible_layer_diesel">
                Diesel
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="visible_layer"
                     id="visible_layer_bev" value="BEV"
                     [ngModel]="scenarioState.visibleLayer$ | async"
                     (ngModelChange)="scenarioState.visibleLayer$.next($event)">
              <label class="form-check-label" for="visible_layer_bev">
                BEV
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="visible_layer"
                     id="visible_layer_olkw" value="OLKW"
                     [ngModel]="scenarioState.visibleLayer$ | async"
                     (ngModelChange)="scenarioState.visibleLayer$.next($event)">
              <label class="form-check-label" for="visible_layer_olkw">
                OLKW
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="visible_layer"
                     id="visible_layer_fcev" value="FCEV"
                     [ngModel]="scenarioState.visibleLayer$ | async"
                     (ngModelChange)="scenarioState.visibleLayer$.next($event)">
              <label class="form-check-label" for="visible_layer_fcev">
                FCEV
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Legende für die Karte -->
      <div class="col-12 col-md-6 d-flex align-items-stretch">
        <div class="card flex-fill">
          <div class="card-body">
            <h4 class="h5">Prognostizierten Fahrten pro Tag pro Abschnitt</h4>

            <table class="table table-borderless table-sm mb-0">
              <tbody id="tbody_legend" class="d-grid">
                @for (legendItem of legendData; track legendItem.name + legendItem.szenario) {
                  @if (legendItem.szenario === (scenarioState.scenario$ | async)) {
                    <tr [attr.data-szenario]="legendItem.szenario">
                      <td>{{ legendItem.name }}</td>
                      <td>
                        <div [style.background]="getGradientColors(legendItem.colors)"
                             style="width: 100%; padding: 6px; background-clip: content-box;"></div>
                      </td>
                      <td>{{ getMinKey(legendItem.colors) }} – {{ getMaxKey(legendItem.colors) }}</td>
                    </tr>
                  }
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
